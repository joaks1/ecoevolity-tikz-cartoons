%% This is a tikz file

\tikzset{node lower left/.style={font=\small,anchor=north east,text height=0.240cm,text depth=0.068cm,inner sep=0.03cm},
leaf/.style={font=\small,anchor=west,text height=0.240cm,text depth=0.068cm},
node upper left/.style={font=\small,anchor=south east,text height=0.240cm,text depth=0.068cm,inner sep=0.03cm},
bracket label/.style={font=\small,anchor=west,text height=0.240cm,text depth=0.068cm,inner sep=0.1cm},
node upper right/.style={font=\small,anchor=south west,text height=0.240cm,text depth=0.068cm,inner sep=0.03cm},
node right/.style={font=\small,anchor=west,text height=0.240cm,text depth=0.068cm,inner sep=0.03cm},
branch/.style={font=\tiny,text height=0.144cm,text depth=0.041cm,inner sep=0.025cm},
root/.style={font=\small,anchor=east,text height=0.240cm,text depth=0.068cm},
node lower right/.style={font=\small,anchor=north west,text height=0.240cm,text depth=0.068cm,inner sep=0.03cm}}

\begin{tikzpicture}[ultra thick,inner sep=0.1cm]

%% Coordinates of nodes.
\coordinate (c1root) at (\maximumdepth-\stemlength,4.500);
\coordinate (c1int) at (\firstdepth,4.500);
\coordinate (c1inttop) at (\firstdepth,5.000);
\coordinate (c1intbottom) at (\firstdepth,4.000);
\coordinate (c1tip) at (5.600,4.500);
\coordinate (c1tiptop) at (5.600,5.000);
\coordinate (c1tipbottom) at (5.600,4.000);

\coordinate (c2root) at (\maximumdepth-\stemlength,2.500);
\coordinate (c2int) at (\seconddepth,2.500);
\coordinate (c2inttop) at (\seconddepth,3.000);
\coordinate (c2intbottom) at (\seconddepth,2.000);
\coordinate (c2tip) at (5.600,2.500);
\coordinate (c2tiptop) at (5.600,3.000);
\coordinate (c2tipbottom) at (5.600,2.000);

\coordinate (c3root) at (\maximumdepth-\stemlength,0.500);
\coordinate (c3int) at (\thirddepth,0.500);
\coordinate (c3inttop) at (\thirddepth,1.000);
\coordinate (c3intbottom) at (\thirddepth,0.000);
\coordinate (c3tip) at (5.600,0.500);
\coordinate (c3tiptop) at (5.600,1.000);
\coordinate (c3tipbottom) at (5.600,0.000);

%% horizontal lines
\draw[line width=\firstPopLineageRootWidth, \popLineageColor] (c1root) -- (c1int);
\iffirstpair{
    \draw[line width=\firstPopLineageLeafWidth, \popLineageColor] (c1inttop) -- (c1tiptop);
    \draw[line width=\firstPopLineageLeafWidth, \popLineageColor] (c1intbottom) -- (c1tipbottom);
}{
    \draw[line width=\firstPopLineageLeafWidth, \popLineageColor] (c1int) -- (c1tip);
}

\draw[line width=\secondPopLineageRootWidth, \popLineageColor] (c2root) -- (c2int);
\ifsecondpair{
    \draw[line width=\secondPopLineageLeafWidth, \popLineageColor] (c2inttop) -- (c2tiptop);
    \draw[line width=\secondPopLineageLeafWidth, \popLineageColor] (c2intbottom) -- (c2tipbottom);
}{
    \draw[line width=\secondPopLineageLeafWidth, \popLineageColor] (c2int) -- (c2tip);
}

\ifshowpopsizelabels{
    \draw[line width=\thirdPopLineageRootWidth, \popLineageColor] (c3root) -- (c3int) node[midway, text=\popSizeLabelColor] {\epopsize[\rootpopindex{}]{}};
}{
    \draw[line width=\thirdPopLineageRootWidth, \popLineageColor] (c3root) -- (c3int);
}
\ifthirdpair{
    \ifshowpopsizelabels{
        \draw[line width=\thirdPopLineageLeafWidth, \popLineageColor] (c3inttop) -- (c3tiptop) node[midway, text=\popSizeLabelColor] {\small\epopsize[\descendantpopindex{1}]{}};
        \draw[line width=\thirdPopLineageLeafWidth, \popLineageColor] (c3intbottom) -- (c3tipbottom) node[midway, text=\popSizeLabelColor] {\small\epopsize[\descendantpopindex{2}]{}};
    }{
        \draw[line width=\thirdPopLineageLeafWidth, \popLineageColor] (c3inttop) -- (c3tiptop);
        \draw[line width=\thirdPopLineageLeafWidth, \popLineageColor] (c3intbottom) -- (c3tipbottom);
    }
}{
    \ifshowpopsizelabels{
        \draw[line width=\thirdPopLineageLeafWidth, \popLineageColor] (c3int) -- (c3tip) node[midway, text=\popSizeLabelColor] {\small\epopsize[\descendantpopindex{}]{}};
    }{
        \draw[line width=\thirdPopLineageLeafWidth, \popLineageColor] (c3int) -- (c3tip);
    }
}

%% vertical lines
\iffirstpair{
    \draw[line cap=rect, line width=\popLineageDefaultWidth, \popLineageColor] (c1inttop) -- (c1intbottom);
}{}
\ifsecondpair{
    \draw[line cap=rect, line width=\popLineageDefaultWidth, \popLineageColor] (c2inttop) -- (c2intbottom);
}{}
\ifthirdpair{
    \draw[line cap=rect, line width=\popLineageDefaultWidth, \popLineageColor] (c3inttop) -- (c3intbottom);
}{}


\ifthirdpair{
    \ifshowalleles{
        \node (a2) [right=0mm of c3tipbottom,circle, red,      fill, inner sep = 1.2pt] {};
        \node (a1) [below=0mm of a2, circle, black!50, fill, inner sep = 1.2pt] {};
        \node (a3) [above=0mm of a2, circle, red,      fill, inner sep = 1.2pt] {};
        
        \node (a5) [right=0mm of c3tiptop,circle, black!50, fill, inner sep = 1.2pt] {};
        \node (a4) [below=0mm of a5, circle, black!50, fill, inner sep = 1.2pt] {};
        \node (a6) [above=0mm of a5, circle, red,      fill, inner sep = 1.2pt] {};
    }{}
    \ifshowallelelabels{
        \node [above=-1.5mm of a3, text=\alleleLabelColor] {\tiny ($\allelecount[2], \redallelecount[2]) = (3, 2)$};
        \node [below=-1.5mm of a4, text=\alleleLabelColor] {\tiny ($\allelecount[1], \redallelecount[1]) = (3, 1)$};
        
        \coordinate (abracket1) at (6.5, 0.75);
        \coordinate (abracket2) at (6.6, 0.75);
        \coordinate (abracket3) at (6.6, 0.28);
        \coordinate (abracket4) at (6.5, 0.28);
        \coordinate (anotation) at (6.6, 0.50);
        
        \draw [thick, line cap=rect, \alleleBracketColor] (abracket1) -- (abracket2) -- (abracket3) -- (abracket4);
        \node [right=0mm of anotation, text=\alleleBracketLabelColor] {$\leafallelecounts, \leafredallelecounts$};
    }{}
}{
    \ifshowalleles{
        \node (a2) [right=0mm of c3tip, circle, red,      fill, inner sep = 1.2pt] {};
        \node (a1) [below=0mm of a2, circle, black!50, fill, inner sep = 1.2pt] {};
        \node (a3) [above=0mm of a2, circle, red,      fill, inner sep = 1.2pt] {};
    }{}
    \ifshowallelelabels{
        \node [below=-1.5mm of a1, text=\alleleLabelColor] {\tiny ($\allelecount[], \redallelecount[]) = (3, 2)$};
    }{}
}


\ifshowislands{
    \ifshowrootisland{
        \coordinate (rootisland) at (\maximumdepth, -1.5);
        \node [left=5mm of rootisland] {\includegraphics[width=1.2cm,angle=270,origin=c]{\rootIslandPath}};
    }{}
    \ifshowtipisland{
        \coordinate (tipisland) at (5.6, -1.5);
        \node [right=-5mm of tipisland] {\includegraphics[width=1.2cm,angle=270,origin=c]{\tipIslandPath}};
    }{}
    \ifshoweventisland{
        \coordinate (island) at (\seconddepth, -1.5);
        \node [right=-10mm of island] {\includegraphics[width=1.2cm,angle=270,origin=c]{\eventIslandPath}};
    }{}
}{}

\ifshowtimearrow{
\coordinate (ntl) at (\maximumdepth-\stemlength, -0.5);
\coordinate (ntr) at (5.6, -0.5);
\node [left=0mm of ntl, text=\timeLabelColor] {\sffamily Time};
\draw [->, >=stealth', line width=\timeLineWidth, \timeLineColor] (ntl) -- (ntr);
}{}

%% events
\ifshoweventlines{
    \draw [\eventLineColor, dashed, line width=\eventLineWidth] (\firstdepth,-0.500) -- (\firstdepth,5.500);
    \ifshoweventlabels{\node [text=\eventLabelColor,font=\LARGE,yshift=0.300cm,text height=0.415cm,text depth=0.118cm] at (\firstdepth,5.500) {\getEventLabel{\firstdepth}};}{}
    
    \ifthenelse{\equal{\firstdepth}{\seconddepth}}{}{
    \draw [\eventLineColor, dashed, line width=\eventLineWidth] (\seconddepth,-0.500) -- (\seconddepth,5.500);
    \ifshoweventlabels{\node [text=\eventLabelColor,font=\LARGE,yshift=0.300cm,text height=0.415cm,text depth=0.118cm] at (\seconddepth,5.500) {\getEventLabel{\seconddepth}};}{}
    }
    
    \ifthenelse{\equal{\firstdepth}{\thirddepth} \OR \equal{\seconddepth}{\thirddepth}}{}{
    \draw [\eventLineColor, dashed, line width=\eventLineWidth] (\thirddepth,-0.500) -- (\thirddepth,5.500);
    \ifshoweventlabels{\node [text=\eventLabelColor,font=\LARGE,yshift=0.300cm,text height=0.415cm,text depth=0.118cm] at (\thirddepth,5.500) {\getEventLabel{\thirddepth}};}{}
    }
}{}


%% leaf labels
\ifshowalleles{
    \renewcommand{\alleleLeafLabelOffset}{0.5mm}
}{}

\ifshowleaflabels{
    \iffirstpair{
        \node [right=\leafLabelOffset of c1tiptop] {\includegraphics[width=14mm]{phylopics/gekko-vittatus-\firstTipTLabelColor-shadow.png}};
        \node [right=\leafLabelOffset of c1tipbottom] {\includegraphics[width=14mm]{phylopics/gekko-vittatus-\firstTipBLabelColor-shadow.png}};
    }{
        \node [right=\leafLabelOffset of c1tip] {\includegraphics[width=14mm]{phylopics/gekko-vittatus-\firstTipTLabelColor-shadow.png}};
    }
    \ifsecondpair{
        \node [right=\leafLabelOffset of c2tiptop] {\includegraphics[width=14mm]{phylopics/gecko-pixabay-cc0-\secondTipTLabelColor-shadow.png}};
        \node [right=\leafLabelOffset of c2tipbottom] {\includegraphics[width=14mm]{phylopics/gecko-pixabay-cc0-\secondTipBLabelColor-shadow.png}};
    }{
        \node [right=\leafLabelOffset of c2tip] {\includegraphics[width=14mm]{phylopics/gecko-pixabay-cc0-\secondTipTLabelColor-shadow.png}};
    }
    \ifthirdpair{
        \node [right=\alleleLeafLabelOffset of c3tiptop] {\includegraphics[width=14mm]{phylopics/gekko-gecko-\thirdTipTLabelColor-shadow.png}};
        \node [right=\alleleLeafLabelOffset of c3tipbottom] {\includegraphics[width=14mm]{phylopics/gekko-gecko-\thirdTipBLabelColor-shadow.png}};
    }{
        \node [right=\alleleLeafLabelOffset of c3tip] {\includegraphics[width=14mm]{phylopics/gekko-gecko-\thirdTipTLabelColor-shadow.png}};
    }
}{}

%% root labels
\ifshowrootlabels{
    \node [left=0mm of c1root] {\includegraphics[width=14mm]{phylopics/gekko-vittatus-\firstRootLabelColor-shadow.png}};
    \node [left=0mm of c2root] {\includegraphics[width=14mm]{phylopics/gecko-pixabay-cc0-\secondRootLabelColor-shadow.png}};
    \node [left=0mm of c3root] {\includegraphics[width=14mm]{phylopics/gekko-gecko-\thirdRootLabelColor-shadow.png}};
}{}


% internal node labels
\ifshownodelabels{
    \node [left=0mm of c1int, text=\nodeLabelColor] {$\comparisondivtime{}_{\scriptscriptstyle 1}$};
    \node [left=0mm of c2int, text=\nodeLabelColor] {$\comparisondivtime{}_{\scriptscriptstyle 2}$};
    \node [left=0mm of c3int, text=\nodeLabelColor] {$\comparisondivtime{}_{\scriptscriptstyle 3}$};
}{}

\ifshowmodels{
    \coordinate (m5) at (7.5,-1.000);
    \coordinate (m4) at (7.5,0.600);
    \coordinate (m3) at (7.5,2.200);
    \coordinate (m2) at (7.5,3.800);
    \coordinate (m1) at (7.5,5.400);
    
    \coordinate (m2bul) at (7.5, 4.6);
    \coordinate (m2bur) at (9.5, 4.6);
    \coordinate (m2bbl) at (7.5, 3.0);
    \coordinate (m2bbr) at (9.5, 3.0);
    
    \coordinate (kbracket1) at (9.6, 4.6);
    \coordinate (kbracket2) at (9.7, 4.6);
    \coordinate (kbracket3) at (9.7, -0.15);
    \coordinate (kbracket4) at (9.6, -0.15);
    
    \node [right=0mm of m5] {\includegraphics[height=14mm]{\modelthreepath}};
    \node [right=0mm of m4] {\includegraphics[height=14mm]{\modeltwothreepath}};
    \node [right=0mm of m3] {\includegraphics[height=14mm]{\modeltwotwopath}};
    \node [right=0mm of m2] {\includegraphics[height=14mm]{\modeltwoonepath}};
    \node [right=0mm of m1] {\includegraphics[height=14mm]{\modelonepath}};
    
    \draw [pblue, very thick, line cap=rect] (m2bul) -- (m2bur) -- (m2bbr) -- (m2bbl) -- (m2bul);
    
    \node [right=21.5mm of m5] {$\nevents = 3$};
    \node [right=21.5mm of m3] {$\nevents = 2$};
    \node [right=21.5mm of m1] {$\nevents = 1$};
    
    \draw [very thick, line cap=rect] (kbracket1) -- (kbracket2) -- (kbracket3) -- (kbracket4);
}{}

\ifshowcomparisonlabels{
    \coordinate (divbracket1) at (-1.2, 5.1);
    \coordinate (divbracket2) at (-1.3, 5.1);
    \coordinate (divbracketlabel) at (-1.3, 3.5);
    \coordinate (divbracket3) at (-1.3, 1.9);
    \coordinate (divbracket4) at (-1.2, 1.9);

    \coordinate (dembracket1) at (-1.2, 1.0);
    \coordinate (dembracket2) at (-1.3, 1.0);
    \coordinate (dembracketlabel) at (-1.3, 0.5);
    \coordinate (dembracket3) at (-1.3, 0.0);
    \coordinate (dembracket4) at (-1.2, 0.0);

    \node [above=1mm of divbracketlabel, align=center, rotate=90] {\sffamily Divergence\\\sffamily comparisons};
    \node [above=1mm of dembracketlabel, align=center, rotate=90] {\sffamily Demographic\\\sffamily comparison};
    
    \draw [very thick, line cap=rect] (divbracket1) -- (divbracket2) -- (divbracket3) -- (divbracket4);
    % \draw [very thick, line cap=rect] (dembracket1) -- (dembracket2) -- (dembracket3) -- (dembracket4);
}{}

\end{tikzpicture}
